JSON
====

JavaScript对象表示法（JavaScript Object Notation，简称json）是一种轻量级的数据交换格式。它基于JavaScript的对象字面量表示法，那么JavaScript最精华的部分之一。尽管只是JavaScript的一个子集，但它与语言无关。它可以被用于在所有以现代编程语言的程序之间交换数据。它是一种文本格式，所以可以被人和机器阅读。它易于实现且易于使用。大量关于JSON的资料都可以在[http://www.JSON.org/](http://www.JSON.org/)中找到。

## JSON

json有6中类型的值： 对象、数组、字符串、数字、布尔值（true和false）和特殊值null。空白（空格符、制表符、回车符和换行符）可被插到任何值的前后。这可以使得JSON文本更容易本人阅读。为了减少传输和存储成本，空白可以被省略。

JSON对象是一个容纳"名/值"对的无序集合。名字可以是任何字符串。值可以是任何类型的JSON值，包括数组和对象。JSON对象可以被无限层地嵌套，但一般涞水保持其结构的相对扁平是搞笑的。大多数语言都有容易被映射为JSON对象的数据类型，比如对象（object）、结构（struct）、字典（dictionary）、哈希表（hash table）、属性列表（property list）或关联数组（associative array）。

JSON数组使一个值的有序序列。其值可以是任何类型的JSON值，包括数组和对象。大多数语言都有容易被映射为JSON数组的数据类型。比如数组（array）、向量（vector）、列表（list）或序列（sequence）。

JSON字符串要被保卫在一堆双引号之间。\字符被用于转义。JSON允许/字符被转义，所以JSON可以被嵌入HTML的<script>标签之中。除非</script>标签初始化，否则HTML不允许实用</字符序列。但JSON允许使用<\/，它能产生同样的结构却不会与HTML混淆。

JSON数字与JavaScript的数字相似。整数的首位不允许为0，因为一些语言用它来标示八进制，这种技术的混乱在数据交换格式中是不可取的。数字可以是整数、实数或科学计数。

就是这样。这就是JSON的全部。JSON的设计目标是称为一个极简的、轻便的和文本式的JavaScript子集。实现互通所需要的共识越少，互通就越容易实现。

## 安全的使用JSON

JSON特别易于用在web应用中，因为JSON就是JavaScript。使用eval函数可以吧一段JSON文本转换成一个有用的数据结构：

```js

var myData = eval('(' + myJSONText + ')');

```

（用圆括号把JSON文本括起来是一种避免JavaScript语法中的歧义的变通方案）然而，eval函数有着骇人的安全问题。用eval去解析JSON文本安全吗？目前，在web浏览中从服务端获取数据的最佳技术是XMLHttpRequest。XMLHttpRequest只能从省城HTML的同一服务器获取数据。使用eval解析来自哪个服务器的文本安全特性和解析最初HTML的安全性一样低。那是假定该服务器存在恶意的前提下，但如果它只是存在漏洞呢？

有漏洞的服务器或许并不能正确地对JSON进行编码。如果它能通过拼凑一些字符串而不是使用一个合适的JSON编码器来创建JSON文本，那么它可能在无意间发送危险数据。如果它充当的是代理的角色，情切尚未确定JSON文本式否格式良好就简单地传递它，那么它可能再次发送了危险数据。

通过使用JSON.parse()方法替换eval就能避免这种危险。如果文本中包含任何危险数据，那么JSON.parse()将抛出异常。为了防止服务器出现漏洞的状况，我推荐你总是使用JSON.parse()来替换eval。计时有一天浏览器提供了连到其他服务器的安全数据访问，使用它同样是个好习惯。

在外部数据与innerHTML进行交互时韩存在另一种危险。一种常见的Ajax模式是把服务端发过来的一个HTML文本片段赋值给某个HTML元素的innerHTML属性，这是一个非常糟糕的资管。如果这个HTML包含一个<script>标签或其等价物，那么一个恶意的脚本将被运行。这可能有事因为服务端存在漏洞。

具体有什么危险呢？如果一个恶意脚本在你的页面上运行，它就有权限访问这个页面所有的状态和该页面能做的操作。它能与你的服务器进行交互，而你的服务器不能区分正当的请求和恶意的请求。恶意的脚本还能访问全局对象，这使得它有权限访问该应用中隐藏于闭包中的变量之外的所有数据。他可以访问document对象，这回事的它有权限访问所有用户所能看到的一切。它还给这个恶意脚本提供了与用户进行会话的能力。浏览器的地址栏和所有的反钓鱼程序将告诉用户这个会话是可靠的。document对象还给该恶意脚本授权访问网络，允许它去下载更多的恶意脚本，或者是在你的防火墙之内探测站点，或者是将它已经窃取的隐私内容发送给世界的任何一个服务器。

这个危险是JavaScript全局变量的直接后果，它是JavaScript众多糟粕之中最糟糕的一个。这些危险并不是有Ajax、json、HMLHttpRequest或web2.0导致的自从JavaScript被引入浏览器，这些危险就已经存在了，并且它将一直存在，知道JavaScript有一天被取代。所以请务必当心。

